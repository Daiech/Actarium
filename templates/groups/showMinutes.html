{% extends "website/layout.html" %}
{% block TITLE %}Acta {{minutes.code}} Grupo {{minutes.id_group.name}} {% endblock %}
{% load gravatartag %}
{%block body%}
<article>
    <header >
        <div class="row-fluid">
        	<div class="span12">
	        	<div class="menu-icons icons-page icon-groups"></div>
	        	<h3>
		        	<a href="/groups/{{group.slug}}">{{group.name}}
		        	</a>
		        	- Acta: {{minutes.code}}
		        </h3>
		    </div>
		    <div>
		    	<span>Fecha de creaci&oacute;n: {{minutes.date_created}}</span>
		    	
        		<a href="/groups/{{group.slug}}/roles-for-this-minutes" class="btn"><i class="icon-plus"></i> Crear acta</a>
	    			<form method="post" class="minutes-form-btn">
	    				{% csrf_token %}
	    				<input type='hidden' id="minutes-html-data" name="minutes-html-data" value="">
	    				<button type='submit' class="btn" ><i class="icon-file"></i> Generar PDF</button>
	    			</form>
		    </div>
	    </div>
    </header>
	<hr>
    <section class="row-fluid">
    	<ul class="pager hoja">
			<li class="previous {%if not prev %}disabled{%endif%}">
				<a href="{%if prev %}/groups/{{group.slug}}/minutes/{{prev.code}}{%else%}#{%endif%}">&larr; Anterior</a>
			</li>
			<li><a href="/groups/{{group.slug}}">Ver listado</a></li>
			<li class="next {%if not next %}disabled{%endif%}">
				<a href="{%if next %}/groups/{{group.slug}}/minutes/{{next.code}}{%else%}#{%endif%}">Siguiente &rarr;</a>
			</li>
		</ul>
		{{minute_template}}
    	<ul class="pager hoja">
			<li class="previous {%if not prev %}disabled{%endif%}">
				<a href="{%if prev %}/groups/{{group.slug}}/minutes/{{prev.code}}{%else%}#{%endif%}">&larr; Anterior</a>
			</li>
			<li><a href="/groups/{{group.slug}}">Ver listado</a></li>
			<li class="next {%if not next %}disabled{%endif%}">
				<a href="{%if next %}/groups/{{group.slug}}/minutes/{{next.code}}{%else%}#{%endif%}">Siguiente &rarr;</a>
			</li>
		</ul>
    </section>
    
	{% include "groups/siteToApprove.html" %}
	
</article>
{%endblock%}
{% block js %}
<script src="{{STATIC_PREFIX}}js/vendor/tiny_mce/tiny_mce.js"></script>
<!-- <script src="{{STATIC_PREFIX}}js/textareas.js"></script> -->
<script>
	$(document).on("ready",function(){
		$(".btn-approve").on("click",setApprove)
		$("#btn-no-approve").on("click",newAnotation)
		$("#button-save").on("click",saveAnotation)
		$('#minutes-html-data').val($('#data-for-pdf').html());
	});
	function callBackSign(data){
		console.log(data)
		$("#div-sign").fadeOut(300,function(){$(this).empty()})
		var u = $("#missing-"+data["user-id"]).html()
		$("#missing-"+data["user-id"]).fadeOut(300,function(){$(this).empty()})
		if(data['approved']==1){
			var l = $("#approved-list")
			if (l.html() == 0){
				l.empty()
			}
			l.append("<li>"+u+"</li>")
			setAlertMessage("Aprobado!", "Haz aprobado esta acta.")
		}
		if(data['approved']==2){
			var l = $("#no-approved-list")
			if(l.html()==0){
				l.empty()
			}
			l.append("<li>"+u+"</li>")
			setAlertMessage("No Aprobado!", "No haz aprobado esta acta.")
		}
	}
	function setApprove(e){
		e.preventDefault();
		$(this).attr({"disabled":"disabled"})
		var minutes_id = $(this).attr("data-minutes");
		var approved = parseInt($(this).attr("data-approve"));
		sendAjax(
			"/groups/setApprove",
			{"m_id":minutes_id, "approve": approved},
			"#btn-sign span",
			callBackSign
			)
	}
	function goToByScroll(element, callback){// Scroll
	    $('html,body').animate({
	        scrollTop: $(element).offset().top},
	        'slow', callback);
	}
	function newAnotation(e){
		e.preventDefault(e);
		tinyMCE.init({
	        theme : "simple",
	        mode : "textareas",
	        height : "80",
	        width : "70%"
		});
		$("#new-anotation").removeClass("hidden");
		goToByScroll("#new-anotation", function(){
			$("#new-anotation textarea").focus();
			tinyMCE.get('textarea-new-anotation').focus()}
		);
	}
	function saveAnotation(e){
		var t = tinymce.get('textarea-new-anotation').getContent();
		var username = "{{user.first_name}} {{user.last_name}}";
		var gravatar = "{{ user.email|showgravatar:'32'}}";
		var m = '<div class="anotation">\
						<div class="user-gravatar pull-left">\
							<img class="size32 avatar" src="' + gravatar + '" alt="' + username + '" />\
						</div>\
						<div class="name-user-anotation">\
							<strong>' + username + '</strong>\
						</div>\
						<div class="content-anotation">'+
							t +
						'</div>\
					</div>';
		$("#anotations").prepend("<li>" + m + "</li>");
		tinymce.get('textarea-new-anotation').setContent("");
	}
</script>
{% endblock %}

{% block style%}
<style>
	.content-anotation{margin-left: 40px}
	.name-user-anotation{margin-left: 40px}
	.anotation{padding: 10px;}
	ul#anotations li{border-bottom: solid thin #dadada;margin-bottom: 20px;}
	#button-save{margin-top: 5px;}
	article header img{margin-top: 10px;}
	.hoja{width: 70%;margin:auto;}
	#sign{margin: 0 auto;margin-top: 20px;min-height: 100px;}
	#minute, .minute{
		border: solid thin #ddd;
		background-color: #fff;
		box-shadow: 8px 8px 6px -6px gray;
		border-radius: 3px;
		/*position: relative;
		top:-55px;*/
	}
	.minute header{
		width: auto;
		margin:30px 0;
		margin-top: 40px;
		margin-left: 0;
		/*padding: 40px;*/
	}
	.minute > div{
		padding: 0 80px;
		/*border: solid thin gray;*/
	}
	.minute footer{
		border: none;
		bottom: 0;
		font-size: 14px;
		left: 0;
		margin:0;
		padding: 20px 40px;
		width: auto;
	}
	.pager{
		margin: 5px auto;
		padding: 0;
		position: relative;
		top: 0;
	}
	.minutes-form-btn{
		display:inline;
	}
	#anotations-approve{margin-top: 20px;}
</style>
{% endblock %}
{% extends "website/layout.html" %}
{% block TITLE %}Actarium - {{TITLE}}{% endblock %}

{%block body%}
<div id="alert-message" class="alert alert-block" style="display: none">
<!--  <button type="button" class="close" data-dismiss="alert">×</button>-->
  <h4></h4>
  <p></p>
</div>
<article>
    <header>
        <img src="{{ STATIC_PREFIX }}{{group.img_group}}"/>
        <h3>{{group.name}}</h3>
        <a href="#" class="btn btn-link">Editar</a>
        <a href="#" class="btn btn-link">Eliminar</a>
    </header>
    <hr/>
    <section class="columnaI">
        <h4>Actas</h4>
        <ul class="nav">
            {%for minute in minutes%}
            <li>
                <a href="#">
                    Acta #{{minute.code}}
                    <span>{{minute.date_created|date}}</span>
                </a>
            </li>
            {%endfor%}
            {%if not minutes%}
            <li>Este grupo no tiene actas</li>
            {%endif%}
        </ul>
        <a href="#" class="btn btn-info btn-small">Crear acta</a>
    </section>
    <section class="columnaD">
        <h4>Miembros</h4>
        <ul class="nav">
            {%for member in members%}
            <li>
                <i class="icon-user"></i>
                {{member.id_user.first_name}} {{member.id_user.last_name}}
                {%if member.id_user != user%}
                <a href="#" title="Eliminar a {{member.id_user.first_name}} de este grupo"><i class="icon-remove"></i></a>
                {%else%}
                <a href="#" title="Administrador de &eacute;ste grupo" ><i class="icon-star"></i></a>
                {%endif%}
            </li>
            {%endfor%} 
        </ul>

        <div class="dropdown">
            <div class="btn btn-info dropdown-toggle" data-toggle="dropdown"  id="add-member">
                Agregar miembro
                <span class="caret"></span>
            </div>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                <li class="taling">
                    Miembros <div id="close-add-member" class="close pull-right">×</div>
                </li>
                <li>
                	<input type="hidden" id="group_id" value="{{group.id}}">
                    <input type="text" placeholder="Nombre de usuario o correo" id="newmember">
                </li>
                <li>
                    <p>Escribe el nombre de usuario o correo electr&oacute;nico del nuevo miembro del grupo.</p>
                </li>
                <li>
                    <ul id="search-result">
                        
                    </ul>
                </li>
            </ul>
            
        </div>
        <div id="my-ajax-result"></div>

    </section>
</article>
{%endblock%}
{% block js %}
<script>
	$("#add-member").on('click focus', function(e) {
        $(this).next(".dropdown-menu").addClass("disblock")
        $("#newmember").focus()
    });

    $("#close-add-member").on("click",function(e){
        $(this).parent().parent().removeClass("disblock")
    });
    $("#newmember").on("keyup",function(e){
        if(e.keyCode==13){
            var user=$("#newmember").val()
            var group_id = $("#group_id").val()
            //go to the server:users
            sendAjax("/groups/invitation",{pk:group_id,search:user},"#my-ajax-result")
            $("#search-result").html("<li><a href='#' class='btn btn-link'>"+user+"</a></li>")          
            setAlert("Enviado","La invitación a unirse al grupo ha sido enviada a "+ user)
            $(this).val("")
        }
    })
</script>
{% endblock %}
{%block style%}
<style>
    .taling{
        text-align: center;
    }
    li a span{
        color:black;
    }
    li p{
        color:gray;
        font-size: 12px;
        line-height:  1;
    }
    article{
        min-height: 400px;
    }
    #group-members ul li {
        border-bottom:solid thin white;
        padding:5px;
    }
    #group-members ul.nav li a{
        border:none;
    }
    article header img{
        margin-top:4px;
        float:left;
    }
    .columnaD{
        margin-left: 400px;    
    }
    article header h3{
        margin:0;
        margin-left:35px;
    }
    #add-member{
    
        position: static;
    }
    .dropdown.dropdown-menu{
        text-decoration: none;
        margin: 5px 20px;
    }
    .dropdownmenu ul li{
        list-style:none;
        text-decoration: none;
    }
    #group-members{
        float:right;
        width:35%;
    }
</style>
{%endblock%}
{% extends "website/layout.html" %}
{% block TITLE %}Actarium - home{% endblock %}

{%block body%}
<article>
    <header class="row-fluid">
        <h1 class="span10">Actarium</h1>
        <div class="fix_btn"><a href="#" class="btn">Feed-back <i class="icon-bullhorn"></i></a></div>
    </header>

    {% if user.is_authenticated %}
    <hr>
    <div class="row-fluid">
        <section class="span6">
            <header>
                <h4>Actividad Reciente</h4>
            </header>
            <div class="accordion " id="accordion">
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#Invitations">
                            Tienes <span id="inv-count" class="badge badge-info">{{invitations|length}}</span> invitaciones a grupos
                        </a>
                    </div>
                    <div  id="Invitations" class="accordion-body collapse in">
                        <ul class="accordion-inner">
                            {% for invitation in invitations %}
                            <li>
                                <span class="notification-text alpha60">
                                    <strong>{{invitation.id_user_from.first_name}}</strong> te invit&oacute; al grupo <a href="/groups/{{invitation.id_group.slug}}">{{invitation.id_group.name}}</a>
                                    <br />
                                    <time>{{invitation.date_invited|date:"F d Y"}}</time>
                                </span>
                                <div class="buttons">
                                <a href="#" data-invitation="s{{invitation.id}}" class="accept-inv btn btn-small btn-info">Aceptar</a>
                                <a href="#" data-invitation="n{{invitation.id}}" class="accept-inv btn btn-small">Cancelar</a>
                                <div class="pull-right load"></div>
                                </div>
                                <hr>

                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#Reunions">
                            Tienes <span class="badge badge-info">{{reunions|length}}</span> reuniones pendientes
                        </a>
                    </div>
                    <div  id="Reunions" class="accordion-body collapse in">
                        <ul class="accordion-inner">
                            {% for reunion in reunions %}
                            <li>
                                <span class="notification-text">
                                    <strong>{{reunion.id_convener.first_name}}</strong> te convoc&oacute; a una reuni&oacute;n del grupo <a href="/groups/{{invitation.id_group.slug}}">{{reunion.id_group.name}}</a><br />
                                    el {{reunion.date_convened|date:"d F"}}
                                </span>
                                <div class="buttons">
                                <a href="#" class="btn btn-small btn-info">Asistir&eacute;</a>
                                <a href="#" class="btn btn-small">No Asistir&eacute;</a>
                                <a class="btn btn-link" href="#">Ver m&aacute;s</a>
                                </div>
                                <hr>

                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div><!--cierra notifications-->
        </section>
        <section class="span5 margint30">
            <header class="row-fluid fix_btn">
                <h4 class="span7">Tus grupos</h4>

                <div class="span4">
                    <a href="/groups/new" class="btn btn-small">
                        <i class="icon-book"></i> Crear Grupo
                    </a>
                </div>
            </header>
            <hr>
            <ul id="group-list" class="nav onOver">
                {% for group in groups %}
                <li class="img-rounded">
                    <a href="/groups/{{group.slug}}">
                        <img src="{{ STATIC_PREFIX }}{{group.img_group}}" alt="{{group.name}}"/>
                        {{group.name}}
                    </a>
                </li>
                {% endfor %}
            </ul>

        </section>
    </div>
    {% else %}
    <div class="containterMargin">
        <p>La soluci&oacute;n empresarial para el registro y seguimiento de sus reuniones.</p>
        <div class="sing">
            <a href="/account/new" class="btn btn-info btn-large">Registrarse</a>
            <a href="/account/login" class="btn btn-info btn-large">Ingresar</a>

        </div>
    </div>
    {% endif %}
</article>
{%endblock%}
{% block style%}
<style>
    .accordion-heading{
        /*background-image: -webkit-linear-gradient(top, #62C462, #51A351);*/

        background-image: -webkit-linear-gradient(top, white, #E6E6E6);
        border-radius:5px;
    }

    .accordion-inner{
        /*background-color: gainsboro;*/
        /* Fallback for web browsers that doesn't support RGBa */
        background: rgb(255, 255, 255) transparent;
        /* RGBa with 0.6 opacity */
        background: rgba(255, 255, 255, 0.6);
        /* For IE 8*/
        -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000,endColorstr=#99000000)";
    }
    .span6 h4{
        margin-bottom:20px;
    }
    span.notification-text{
        display: block;
    }
    h4{
        margin:0;
        padding:0;
    }
    header h1{
        margin: 0;
    }
    .span2{
        margin-right: 20px;
    }
    .span6{
        border-right: solid thin #dadada;
        padding: 0 20px;
    }
    section div ul li{
        list-style-type: none;
        font-size: 12px;
        margin-bottom: 5px;
    }
    li hr{
        margin:20;
    }
    ul{
        margin:0;
    }
    .containterMargin{
        margin:20px;
    }
    .buttons{
        margin-top:10px;
    }
</style>
{%endblock%}
{% block js %}
<script>
    //$("#menu-account").addClass("active")
    $(".collapse").collapse({
        //toggle: false
    })
    $(".accept-inv").on("click",function(e){
        e.preventDefault();
        var accept = $(this).attr("data-invitation")
        sendAjax(
        "/groups/acceptInvitation",
        {"i_id":accept},
        $(this).find("div.load"),
        function(data){
            if (data["accepted"]){
                setAlert("invitation","Aceptar la invitacion "+accept.substr(1))
                {
        var actual = parseInt($("#inv-count").text())
        actual--
        $("#inv-count").text(""+actual)
        $("#group-list").append(
            "<li class='img-rounded'>"+
                    "<a href='/groups/'>"+
                        "<img src='/static/img/org.png' alt=''/>"+
                        "Nombre Grupo"+
                    "</a>"+
                "</li>")
    }
                
            }
            else{
                setAlert("invitation","No Aceptar la invitacion "+accept.substr(1))
            }
        }
    )
    })
    $(".restar").on("click",function(){
        var actual = parseInt($("#inv-count").text())
        actual--
        $("#inv-count").text(""+actual)
        $("#group-list").append(
            "<li class='img-rounded'>"+
                    "<a href='/groups/'>"+
                        "<img src='/static/img/org.png' alt=''/>"+
                        "Nombre Grupo"+
                    "</a>"+
                "</li>")
    })
</script>
{% endblock %}
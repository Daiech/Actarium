{% extends "website/layout.html" %}
{% block TITLE %}Actarium - home{% endblock %}

{%block body%}


{% if user.is_authenticated %}
<article>
    <header class="row-fluid">
        <h1 class="span10">Actarium</h1>
        <div class="fix_btn"><a href="#myModal" role="button" class="btn" data-toggle="modal">Feed-back <i class="icon-bullhorn"></i></a></div>
    </header>
    <hr>
    <div class="row-fluid">
        <section class="span6">
            <header>
                <h4>Actividad Reciente</h4>
            </header>
            <div class="accordion " id="accordion">
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#Invitations">
                            Tienes <span id="inv-count" class="badge badge-info">{{invitations|length}}</span> invitaciones a grupos
                        </a>
                    </div>
                    <div  id="Invitations" class="accordion-body collapse in">
                        <ul class="accordion-inner">
                            {% for invitation in invitations %}
                            <li>
                                <span class="notification-text alpha60">
                                    <strong>{{invitation.id_user_from.first_name|lower|capfirst}}</strong> te invit&oacute; al grupo <a href="/groups/{{invitation.id_group.slug}}">{{invitation.id_group.name|lower|capfirst}}</a>
                                    <br />
                                    <time datetime="{{reunion.date_convened|date:'c'}}">El {{invitation.date_invited}}</time>
                                </span>
                                <div class="buttons">
                                    <button type="button" data-invitation="s{{invitation.id}}" class="accept-inv btn btn-small btn-info">
                                        Aceptar 
                                        <span class="load"></span>
                                    </button>
                                    <button type="button" data-invitation="n{{invitation.id}}" class="accept-inv btn btn-small">
                                        Cancelar
                                        <span class="load"></span>
                                    </button>
                                    <div class="pull-right load"></div>
                                </div>
                                <hr>

                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#Reunions">
                            Tienes <span class="badge badge-info">{{reunions|length}}</span> reuniones pendientes
                        </a>
                    </div>
                    <div  id="Reunions" class="accordion-body collapse in">
                        <ul class="accordion-inner">
                            {% for reunion in reunions %}
                            <li>
                                <span class="notification-text">
                                    <strong>{{reunion.id_convener.first_name}}</strong> te convoc&oacute; a una reuni&oacute;n del grupo <a href="/groups/{{invitation.id_group.slug}}">{{reunion.id_group.name}}</a><br />
                                    <time datetime="{{reunion.date_convened|date:'c'}}">El {{reunion.date_convened}}</time>
                                </span>
                                <div class="buttons">
                                    <a href="#" class="btn btn-small btn-info">Asistir&eacute;</a>
                                    <a href="#" class="btn btn-small">No Asistir&eacute;</a>
                                    <a class="btn btn-link" href="#">Ver m&aacute;s</a>
                                </div>
                                <hr>

                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div><!--cierra notifications-->
        </section>
        <section class="span5 margint30">
            <header class="row-fluid fix_btn">
                <h4 class="span7">Tus grupos</h4>

                <div class="span4">
                    <a href="/groups/new" class="btn btn-small">
                        <i class="icon-book"></i> Crear Grupo
                    </a>
                </div>
            </header>
            <hr>
            <ul id="group-list" class="nav onOver">
                {% for group in groups %}
                <li class="img-rounded">
                    <a href="/groups/{{group.slug}}">
                        <img src="{{ STATIC_PREFIX }}{{group.img_group}}" alt="{{group.name}}"/>
                        {{group.name}}
                    </a>
                </li>
                {% endfor %}
            </ul>

        </section>
    </div>
</article>
{% else %}
<div id="new-container">
    <img src="/static/img/logo_grande.png" alt="Logo Actarium"/>
</div>
<div id="info-act" style="display:none">
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    Aqu&iacute; consignaremos informaci&oacute;n de inter&eacute;s sobre Actarium.
    <a href="/"><img id="arriba" src="/static/img/arrow-up.png" alt="arriba"/></a>
</div>
<div class="info-containter">
    <div class="info-pics">
        <div class="pic-log">
            <a href="/account/login" >
                <div id="left-bubble">
                    <div class="bubble-text">
                        Ingresar
                    </div>

                </div>
            </a>
            <div id="login-pic">
                <img src="/static/img/iniciar_Sesion.png" alt="Log In" />
            </div>
        </div>
        <div class="pic-down">
            <a href="#" title="info"><img src="/static/img/flecha-abajo.png" alt="" /></a>
        </div>

        <div class="pic-log">
            <a href="/account/new">
                <div class="right-bubble">
                    <div class="bubble-text">
                        Registrarse
                    </div>
                </div>
            </a>
            <div id="singup-pic">
                <img src="/static/img/registro.png" alt="Sing Up" />
            </div>
        </div>


    </div>
</div>


{% endif %}

{%endblock%}
{% block style%}
<style>

    /* **************************************************************************** 
    Index Website
    **************************************************************************** */
    .container{
        width:100%;
    }
    #new-container{
        background-color: #E9E9E9;
        height: 200px;
        width: 100%;
    }
    #new-container > img{
        display: block;
        margin: auto;       
        padding-top: 30px;
        width:350px;
    }
    .info-pics{
        display:block;
        margin:auto;
        overflow: hidden;
        width:585px;
    }
    .pic-log{
        float: left;
        margin-top: 30px;
        width:260px;
    }
    #login-pic{
        position: relative;
        left:100px;
        top:-25px;
    }
    #singup-pic{
        position: relative;
        top:-25px;
    }
    #left-bubble{
        background-image: url('/static/img/left-bubble.png');
        color: white;
        width:166px;
        height: 89px;
        position: relative;
        text-align: center;
    }
    .right-bubble{
        background-image: url('/static/img/right-bubble.png');
        color: white;
        width: 166px;
        height: 89px;
        left:90px;
        position:relative;
        text-align: center;
    }
    .pic-down {
        float: left;
        margin: -10px 10px 0 10px;
        z-index: 100000;
    }
    .bubble-text {
        position: relative;
        top: 30px;
    }
    #info-act{
        background-color: #dadada;
        padding-left: 50px;
        padding-right: 50px;
        padding-bottom: 20px;
        padding-top: 20px;
    }
    #info-act a > img{
        float: right;
    }
    /* **************************************************************************** 
    Termina Index Website
    **************************************************************************** */


    .accordion-heading{
        /*background-image: -webkit-linear-gradient(top, #62C462, #51A351);*/

        background-image: -webkit-linear-gradient(top, white, #E6E6E6);
        border-radius:5px;
    }

    .accordion-inner{
        /*background-color: gainsboro;*/
        /* Fallback for web browsers that doesn't support RGBa */
        background: rgb(255, 255, 255) transparent;
        /* RGBa with 0.6 opacity */
        background: rgba(255, 255, 255, 0.6);
        /* For IE 8*/
        -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#11111111,endColorstr=#11111111)";
    }
    .span6 h4{
        margin-bottom:20px;
    }
    span.notification-text{
        display: block;
    }
    h4{
        margin:0;
        padding:0;
    }
    header h1{
        margin: 0;
    }
    .span2{
        margin-right: 20px;
    }
    .span6{
        border-right: solid thin #dadada;
        padding: 0 20px;
    }
    section div ul li{
        list-style-type: none;
        font-size: 12px;
        margin-bottom: 5px;
    }
    li hr{
        margin:20;
    }
    ul{
        margin:0;
    }
    .containterMargin{
        margin:20px;
    }
    .buttons{
        margin-top:10px;
    }
</style>
{%endblock%}
{% block js %}
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script>
    $(".pic-down").on("click",function(e){
        e.preventDefault()
         $("#info-act").slideToggle("fast")
    })
    
    $("#arriba").on("click",function(e){
        e.preventDefault()
        $("#info-act").slideToggle("fast")
    })
    
    $(".collapse").collapse({
        //toggle: false
    })
function acceptInvitation(element, accept){
    sendAjax(
    "/groups/acceptInvitation",
    {"i_id":accept},
    $(element).find(".load"),
    function(data){
        if (data["accepted"]){
            var actual = parseInt($("#inv-count").text());
            actual--;
            $("#inv-count").text(""+actual);
            $("#group-list").append(
            "<li class='img-rounded'>"+
                "<a href='"+data["group"]["slug"]+"'>"+
                "<img src='{{STATIC_PREFIX}}"+data["group"]["img_group"]+"' alt=''/>"+
                data["group"]["name"]+
                "</a>"+
                "</li>")
            $(element).parent().parent().slideUp(900,function(){
                $(this).empty().html(
                "Ahora perteneces al grupo "+
                    "<a href='#'>"+data["group"]["name"]+"</a>"+
                    "<hr>"
            ).fadeIn()
            }
        )
            setAlertMessage("Invitaci&oacute;n a un nuevo grupo",
            "Ahora puedes acceder al grupo"+data["group"]["name"]+".")
        }
        else{
            $(element).parent().parent().slideUp(900,function(){
                $(this).empty().html(
                "Cancelaste la invitaci&oacute;n para unirte al grupo "+data["group"]["name"]+"."+
                    "<br>"+
                    "Si lo hiciste por error comunicate con el administrador del grupo para "+
                    "obtener una nueva invitaci&oacute;n."+
                    "<hr>"
            ).fadeIn()
            })
            var actual2 = parseInt($("#inv-count").text())
            actual2--
            $("#inv-count").text(""+actual2)
            setAlertMessage("Invitaci&oacute;n a un nuevo grupo",
            "Haz rechazado la invitaci&oacute;n")
        }
    })
}
$(".accept-inv").on("click",function(e){
    e.preventDefault();
    $(this).attr("disabled", "disabled");
    var accept = $(this).attr("data-invitation")
    if(accept.substring(0,1)=="n"){
        if(confirm("¿Seguro que no quieres ser parte de este grupo?")){
            acceptInvitation($(this), accept)
        }
    }else{
        acceptInvitation($(this), accept)
    }
})
</script>
{% endblock %}